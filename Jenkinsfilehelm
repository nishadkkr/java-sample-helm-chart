pipline {
    agent any
    parameters {
        string(name : 'buildnum', description: 'production')
    }
    
    stages {
        stage("Pull from ECR") {
            steps {
                sh 'rm -rf helm-maven'
                sh 'aws ecr-public get-login-password --region us-east-1 | helm registry login --username AWS --password-stdin public.ecr.aws/z5n5i3j5'
                sh 'helm pull oci://public.ecr.aws/z5n5i3j5/helm-maven --version 1.${params.Environment}.1 --untar'
            }
        }
        stage("Deploy to Minikube") {
            steps {
                sh 'helm install helm-maven helm-maven'
            }
        }
    }
}